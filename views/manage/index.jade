!= partial('../topnavbar.jade')
	.container-fluid
		.row-fluid
			.span2
				!= partial('sidebar.jade')
			//tabs view
			div(data-bind="with:manageTabsView").span10
				ul(data-bind="foreach: tabs").nav.nav-tabs
					li(data-bind="css:{active: $data == $parent.chosenTabId()}, click: $parent.goToTab")
						a(data-bind="html: $parent.tabData($data)")
				
			//ticket list view		
			div(data-bind="with:manageTableView").span10
				div(data-bind="visible: shouldShowTable, css:{hide: !shouldShowTable}").hide
					table#ticketlist.table.table-bordered.table-striped(data-bind="dataTable: { dataSource: tickets, rowTemplate: 'ticketListTemplate',  options: {bSort: false, iDisplayLength: 25}, columns: ['age', 'subject', 'from', 'friendlydate', 'impact'] }")
							thead
									tr
										th age									
										th impact
										th subject									
										th from
										th date

			//individual ticket view
			div(data-bind="with:manageTicketView").span10			
				//section only shown if ticketData has content
				//default css hide on load, reverse when needed (avoids load flicker)
				div(data-bind="with: ticketData, css:{hide: !shouldShowTicket}").hide.span10
					.btn-toolbar.pull-right
						.btn-group
							a(data-toggle="modal", data-target="#deleteModal").btn.btn-warning Delete Ticket
						.btn-group
							button(data-toggle="dropdown").btn Impact <span class="caret"></span>
								ul(data-bind="foreach: $parent.impacts").dropdown-menu
									li
										a(data-bind="text: $data, click: $root.manageTicketView.changeImpact")
						.btn-group
							button(data-toggle="dropdown").btn Status <span class="caret"></span>
								ul(data-bind="foreach: $root.manageTabsView.tabs").dropdown-menu
									li
										a(data-bind="text: $data, click: $root.manageTicketView.changeStatus")
						.btn-group
							button(data-bind="css:{disabled: true}").btn Edit Ticket
						.btn-group
							button(data-bind="click: $parent.closeTicket, disable: $parent.isClosed(), css:{disabled: $parent.isClosed()}").btn.btn-primary Close Ticket

					br
					ul.unstyled	
						li
							p <span class="label label-info">ID</span> <span data-bind="text: _id"></span>
						li
							p <span class="label label-info">age</span> <span data-bind="text: age"></span> - <span data-bind="text: friendlydate"></span>
						li
							p <span class="label label-info">status</span> <span data-bind="text: status()"></span>
						li
							p <span class="label label-info">impact</span> <span class="badge" data-bind="text: impact()"></span>
						li
							p <span class="label label-info">from:</span> <strong data-bind="text: from"></strong>

					hr
					h1(data-bind="text: subject")
					hr
				div(data-bind="with: ticketData, visible: ticketData, css:{hide: !shouldShowTicket}").hide.span10.well
					p(data-bind="html: description")


<script Id="ticketListTemplate" type="text/html">
<td width=7.5% data-bind="text: age"></td>
<td width=7.5% data-bind="text: impact"></td>
<td width= 50%><a data-bind="text: subject"></a></td>
<td data-bind="text: from"></td>
<td data-bind="text: friendlydate"></td>
</script>

!= partial('modals.jade')

script(src="/js/lib/sammy.min.js")
script(src="/js/lib/moment.min.js")		
script(src="/js/lib/knockout.bindings.dataTables.js")
script(src="/js/lib/jquery.dataTables.min.js")	
script(src="/js/lib/bootstrap.datatables.js")		
script(src="/js/lib/knockout.mapping.js")	
script(src="/js/topbar-viewmodel.js")
script(src="/js/manage-viewmodelcontroller.js")
script
	//get to work!
	now.ready(function(){
		var controller = ko.applyBindings(new ManageViewModelController(now.statusList));
	});




